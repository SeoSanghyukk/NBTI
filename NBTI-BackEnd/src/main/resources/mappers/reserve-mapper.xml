<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="Reserve">
  
  	<insert id="insert">
  		INSERT 
  		INTO reserve VALUES (reserve_seq.nextval, #{member_id},#{reserve_title_code} ,#{purpose},#{start_time}, #{end_time} , 'N')
  	</insert>
  	
  	<select id="waitingList" resultType="com.nbti.dto.ReserveDTO">
		SELECT 
		    r.seq,
		    r.member_id,
		    CASE 
		        WHEN r.reserve_title_code = '1' THEN '회의실'
		        WHEN r.reserve_title_code = '2' THEN '비품'
		        WHEN r.reserve_title_code = '3' THEN '차량'
		        ELSE '기타' 
		    END AS reserve_title_code,
		    r.purpose,
		    r.start_time,
		    r.end_time,
		    r.state
		FROM 
		    reserve r
		WHERE 
		    r.state = 'N'
		ORDER BY 
		    r.start_time
  	</select>

  	
	<!-- 목록 -->
	<resultMap id="reserveResultMap" type="com.nbti.dto.ReserveDTO">
        <id property="seq" column="reservation_seq"/>
        <result property="member_id" column="name"/>
        <result property="reserve_title_code" column="reserve_title_code"/>
        <result property="purpose" column="purpose"/>
        <result property="start_time" column="start_time"/>
        <result property="end_time" column="end_time"/>
        <result property="state" column="state"/>
    </resultMap>

    <select id="waitList" resultMap="reserveResultMap">
        SELECT 
            r.seq AS reservation_seq,
            r.member_id,
            m.name,  
            CASE 
                WHEN r.reserve_title_code = '1' THEN '회의실'
                WHEN r.reserve_title_code = '2' THEN '비품'
                WHEN r.reserve_title_code = '3' THEN '차량'
                ELSE '기타' 
            END AS reserve_title_code,
            r.purpose,
            r.start_time,
            r.end_time,
            r.state
        FROM 
            reserve r
        JOIN 
            members m ON r.member_id = m.id 
        WHERE 
            r.state = 'N'
        ORDER BY 
            r.start_time
    </select>
    
	<!-- 예약 승인 Y 업데이트 -->
    <update id="updateReservationStatus" parameterType="map">
	    UPDATE reserve 
	    SET state = #{state} 
	    WHERE seq = #{seq}
	</update>






  	
  </mapper>